---
title: "POL_279_Assign2"
author: "E Zufall"
date: "2/2/2023"
output: pdf_document
knit: (function(inputFile, encoding) {
  rmarkdown::render(inputFile, encoding = encoding, output_dir = "../reports") })
---
## Assignment 3

For this assignment, I used the same GSP governance network dataset as in my previous assignments and selected three GSPs: 0124, 0061, and 0047.

However, for the calculations on triangles and transitivity, I used a binarized form of the matrix where any node pairs with an edge weight of at least 1 were converted into an edge weight of 1, with a weight of 0 otherwise. This was so that the number of triangles did not increase out of control for highly weighted edges.


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r packg, message=F, warning=F}
library(network)
library(sna)
library(igraph)
library(intergraph)
library(tidyverse)
```

## Hypothesis
Transitivity and Centrality Hypothesis: 
I think transitivity will be positively correlated with eigenvector centrality but negatively correlated with betweenness centrality. 

Reasoning: This is because as the number of high-degree-centrality neighbors increases, I think they are more likely to be connected to friends of friends, because we already know these nodes are likely to have lots of connections. However, I don't think transitivity is going to be highly correlated with betweenness, because triadic closure among the neighbors decreases the percentage of pathways that those nodes must take through the ego, thereby decreasing its relative betweenness. 

I will use a Pearson correlation test for testing my hypothesis.

Transitivity and Type Hypothesis:
I think organizations and people will have the highest transitivity, because they can make decisions to collaborate with people based on mutual friends, whereas geopolitical entities are probably not discussed in a transitive way in these sentences because plan actions in a particular GPE that are being discussed in one sentence are probably not transitive to other GPE.

I will be testing the relationship between transitivity and type, using a one-way ANOVA test.

## Discussion
As shown in the following section, my Transitivity and Centrality Hypothesis was partially true: transitivity was indeed negatively correlated with betweenness centrality, and in two of the scenarios this effect was of a larger absolute value than the correlation between transitivity and eigenvector centrality. However, in all cases, there was also a negative correlation between transitivity and eigenvector centrality, which I was not expecting. This is probably because it is easier for all relationships to be transitive when a node has a low degree than when it is a high degree, since there would have to be many more triangles that are closed if the node has a high degree.

My Transitivity and Type Hypothesis was correct: organizations and people indeed had higher transitivity than did geopolitical entities (but organizations did not have significantly different transitivity than people did).

## Results
Results and code are shown below.

```{r libs, message=F, warning=F}
library(ggplot2)
library(ggpubr)
library(broom)
library(AICcmodavg)
library(tidyverse)
```

``` {r transitiv, eval = FALSE}

#calculate transitivity
for(m in list){
  print(paste0("GSP ID ",gspids[m]))
  
  adj_mat <- readRDS(paste0("../data/adjmat_orig_",gspids[m]))
  adj_mat <- as(adj_mat, "sparseMatrix")
  
  binary_mat <- as.matrix((adj_mat>0)+0)
  binary_mat <- as(binary_mat, "sparseMatrix")

  diag(binary_mat) <- 0
  
  t_binary_mat <- t(binary_mat)
  binary_sq <- binary_mat %*% t_binary_mat
  saveRDS(binary_sq, paste0("../data/binarymat_sq_",gspids[m]))
  
  triangles <- binary_mat * binary_sq
  saveRDS(triangles, paste0("../data/triangles_",gspids[m]))
  node_degree <- colSums(binary_mat)
  node_triangles <- colSums(triangles)
  temp <- tibble(node_degree, node_triangles)
  temp <- temp %>% mutate(node_transitivity = node_triangles/(node_degree*(node_degree-1)))
  temp$name <- rownames(binary_mat)
  
  centr_df <- readRDS(paste0("../data/node_attr_",gspids[m]))
  
  centr_df <- full_join(centr_df, temp, by = c("name"))
  
  saveRDS(centr_df, paste0("../data/node_attr_tr_",gspids[m]))
  
}

```


```{r anovas}

gsp_text_with_meta <- readRDS("../data/prepped_for_sna")
gspids <- unique(gsp_text_with_meta$gsp_id)
rm(gsp_text_with_meta)

list <- c(99,33,45)

#boxplot: org_type and transitivity
#correlation: transitivity ~ eig centrality
#correlation: transitivity ~ betw centrality
#anova: transitivity ~ type
for(m in list){
  print(paste0("GSP ID ",gspids[m]))
  
  centr_df <- readRDS(paste0("../data/node_attr_tr_",gspids[m]))
  ##SUBSETTING FOR POL 279 ASSIGNMENT 2 
  centr_df <- centr_df %>% filter(type %in% c("ORG","GPE","PERSON"))
  ggplot(centr_df, aes(x=type, y=node_transitivity)) + 
    geom_boxplot()
  
  print(cor.test(centr_df$eigenvector, centr_df$node_transitivity, 
                 method = "pearson"))
  plot(centr_df$eigenvector, centr_df$node_transitivity)
  
  print(cor.test(centr_df$between, centr_df$node_transitivity, 
                 method = "pearson"))
  plot(centr_df$between, centr_df$node_transitivity)
  
  one_way_anova <- aov(node_transitivity ~ as.factor(type), data = centr_df)
  print(summary(one_way_anova))
  print(one_way_anova$coefficients)
  print(TukeyHSD(one_way_anova))
}
```


